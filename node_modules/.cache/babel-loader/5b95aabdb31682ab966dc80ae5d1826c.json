{"ast":null,"code":"import _regeneratorRuntime from\"/Users/xcodedeveloper/Desktop/grade0swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/xcodedeveloper/Desktop/grade0swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/xcodedeveloper/Desktop/grade0swap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState,useRef}from\"react\";import{Contract,ethers}from\"ethers\";import{createTheme,ThemeProvider}from\"@material-ui/core\";import{SnackbarProvider}from\"notistack\";import ConnectWalletPage from\"./Components/connectWalletPage\";import{getAccount,getFactory,getRouter,getNetwork,getWeth}from\"./ethereumFunctions\";import COINS from\"./constants/coins\";import*as chains from\"./constants/chains\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var theme=createTheme({palette:{primary:{main:\"#ff0000\",contrastText:\"#ffffff\"},secondary:{main:\"#9e9e9e\",contrastText:\"#ffffff\"}}});var autoReconnectDelay=5000;var Web3Provider=function Web3Provider(props){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isConnected=_useState2[0],setConnected=_useState2[1];var network=Object.create({});network.provider=useRef(null);network.signer=useRef(null);network.account=useRef(null);network.coins=[];network.chainID=useRef(null);network.router=useRef(null);network.factory=useRef(null);network.weth=useRef(null);var backgroundListener=useRef(null);function setupConnection(){return _setupConnection.apply(this,arguments);}function _setupConnection(){_setupConnection=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;console.log('lets go!');//const url = 'http://154.53.41.80:8545';\n//network.provider = new ethers.providers.JsonRpcProvider(url);\n//network.provider = new ethers.providers.JsonRpcProvider('http://154.53.41.80:8545');\nnetwork.provider=new ethers.providers.Web3Provider(window.ethereum);_context4.next=5;return network.provider.getSigner();case 5:network.signer=_context4.sent;_context4.next=8;return getAccount().then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(result){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:network.account=result;case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}());case 8:_context4.next=10;return getNetwork(network.provider).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(chainId){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// Set chainID\nnetwork.chainID=chainId;if(!chains.networks.includes(chainId)){_context3.next=13;break;}_context3.next=4;return getRouter(chains.routerAddress.get(chainId),network.signer);case 4:network.router=_context3.sent;// Get default coins for network\nnetwork.coins=COINS.get(chainId);// Get Weth address from router\n_context3.next=8;return network.router.WETH().then(function(wethAddress){network.weth=getWeth(wethAddress,network.signer);// Set the value of the weth address in the default coins array\nnetwork.coins[0].address=wethAddress;});case 8:_context3.next=10;return network.router.factory().then(function(factory_address){network.factory=getFactory(factory_address,network.signer);});case 10:setConnected(true);_context3.next=15;break;case 13:console.log(\"Wrong network mate.\");setConnected(false);case 15:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref3.apply(this,arguments);};}());case 10:_context4.next=15;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[0,12]]);}));return _setupConnection.apply(this,arguments);}function createListener(){return _createListener.apply(this,arguments);}function _createListener(){_createListener=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var account;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return getAccount();case 3:account=_context5.sent;if(!(account!=network.account)){_context5.next=7;break;}_context5.next=7;return setupConnection();case 7:_context5.next=14;break;case 9:_context5.prev=9;_context5.t0=_context5[\"catch\"](0);setConnected(false);_context5.next=14;return setupConnection();case 14:case\"end\":return _context5.stop();}}},_callee5,null,[[0,9]]);})),1000));case 1:case\"end\":return _context6.stop();}}},_callee6);}));return _createListener.apply(this,arguments);}useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var listener;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// Initial setup\nconsole.log(\"Initial hook\");_context.next=3;return setupConnection();case 3:console.log(\"network: \",network);// Start background listener\nif(backgroundListener.current!=null){clearInterval(backgroundListener.current);}listener=createListener();backgroundListener.current=listener;return _context.abrupt(\"return\",function(){return clearInterval(backgroundListener.current);});case 8:case\"end\":return _context.stop();}}},_callee);})),[]);var renderNotConnected=function renderNotConnected(){console.log(\"Rendering\");return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(ConnectWalletPage,{})})});};return/*#__PURE__*/_jsxs(_Fragment,{children:[!isConnected&&renderNotConnected(),isConnected&&/*#__PURE__*/_jsxs(\"div\",{children:[\" \",props.render(network)]})]});};export default Web3Provider;","map":{"version":3,"sources":["/Users/xcodedeveloper/Desktop/grade0swap/src/network.js"],"names":["useEffect","useState","useRef","Contract","ethers","createTheme","ThemeProvider","SnackbarProvider","ConnectWalletPage","getAccount","getFactory","getRouter","getNetwork","getWeth","COINS","chains","theme","palette","primary","main","contrastText","secondary","autoReconnectDelay","Web3Provider","props","isConnected","setConnected","network","Object","create","provider","signer","account","coins","chainID","router","factory","weth","backgroundListener","setupConnection","console","log","providers","window","ethereum","getSigner","then","result","chainId","networks","includes","routerAddress","get","WETH","wethAddress","address","factory_address","createListener","setInterval","current","clearInterval","listener","renderNotConnected","render"],"mappings":"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","sourcesContent":["import { useEffect, useState, useRef } from \"react\";\nimport { Contract, ethers } from \"ethers\";\nimport { createTheme, ThemeProvider } from \"@material-ui/core\";\nimport { SnackbarProvider } from \"notistack\";\nimport ConnectWalletPage from \"./Components/connectWalletPage\";\nimport {\n  getAccount,\n  getFactory,\n  getRouter,\n  getNetwork,\n  getWeth,\n} from \"./ethereumFunctions\";\nimport COINS from \"./constants/coins\";\nimport * as chains from \"./constants/chains\";\n\nconst theme = createTheme({\n  palette: {\n    primary: {\n      main: \"#ff0000\",\n      contrastText: \"#ffffff\",\n    },\n    secondary: {\n      main: \"#9e9e9e\",\n      contrastText: \"#ffffff\",\n    },\n  },\n});\n\nconst autoReconnectDelay = 5000;\n\nconst Web3Provider = (props) => {\n  const [isConnected, setConnected] = useState(true);\n  let network = Object.create( {} )\n  network.provider = useRef(null);\n  network.signer = useRef(null);\n  network.account = useRef(null);\n  network.coins = [];\n  network.chainID = useRef(null);\n  network.router = useRef(null);\n  network.factory = useRef(null);\n  network.weth = useRef(null);\n  const backgroundListener = useRef(null);\n  async function setupConnection() {\n    try {\n      console.log('lets go!');\n      //const url = 'http://154.53.41.80:8545';\n\n      //network.provider = new ethers.providers.JsonRpcProvider(url);\n      //network.provider = new ethers.providers.JsonRpcProvider('http://154.53.41.80:8545');\n\n      network.provider = new ethers.providers.Web3Provider(window.ethereum);\n      network.signer = await network.provider.getSigner();\n      await getAccount().then(async (result) => {\n        network.account = result;\n      });\n\n      await getNetwork(network.provider).then(async (chainId) => {\n        // Set chainID\n        network.chainID = chainId;\n        if (chains.networks.includes(chainId)) {\n          // Get the router using the chainID\n          network.router = await getRouter(\n            chains.routerAddress.get(chainId),\n            network.signer\n          );\n          // Get default coins for network\n          network.coins = COINS.get(chainId);\n          // Get Weth address from router\n          await network.router.WETH().then((wethAddress) => {\n            network.weth = getWeth(wethAddress, network.signer);\n            // Set the value of the weth address in the default coins array\n            network.coins[0].address = wethAddress;\n          });\n          // Get the factory address from the router\n          await network.router.factory().then((factory_address) => {\n            network.factory = getFactory(\n              factory_address,\n              network.signer\n            );\n          });\n          setConnected(true);\n        } else {\n          console.log(\"Wrong network mate.\");\n          setConnected(false);\n        }\n      });\n\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  async function createListener() {\n    return setInterval(async () => {\n      // console.log(\"Heartbeat\");\n      try {\n        // Check the account has not changed\n        const account = await getAccount();\n        if (account != network.account) {\n          await setupConnection();\n        }\n        // const chainID = await getNetwork(network.provider);\n        // if (chainID !== network.chainID){\n        //   setConnected(false);\n        //   await setupConnection();\n        // }\n      } catch (e) {\n        setConnected(false);\n        await setupConnection();\n      }\n    }, 1000);\n  }\n\n  useEffect(async () => {\n    // Initial setup\n    console.log(\"Initial hook\");\n    await setupConnection();\n    console.log(\"network: \", network);\n\n    // Start background listener\n    if (backgroundListener.current != null) {\n      clearInterval(backgroundListener.current);\n    }\n    const listener = createListener();\n    backgroundListener.current = listener;\n    return () => clearInterval(backgroundListener.current);\n  }, []);\n\n  const renderNotConnected = () => {\n    console.log(\"Rendering\");\n    return (\n      <div className=\"App\">\n        <div>\n          <ConnectWalletPage />\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <>\n      {!isConnected && renderNotConnected()}\n      {isConnected && <div> {props.render(network)}</div>}\n    </>\n  );\n};\n\nexport default Web3Provider;\n"]},"metadata":{},"sourceType":"module"}